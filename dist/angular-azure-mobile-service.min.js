angular.module("azure-mobile-service.module",[]).service("Azureservice",["$q","AzureMobileServiceClient",function(e,r){"use strict";var n=r.API_URL,o=r.API_KEY,t=["google","twitter","facebook","microsoftaccount","aad"],i=WindowsAzure.MobileServiceClient,u=new i(n,o),s=function(e){sessionStorage.loggedInUser=JSON.stringify(e)},l=function(e){u.currentUser=e},c=function(){sessionStorage.loggedInUser&&(u.currentUser=JSON.parse(sessionStorage.loggedInUser))};c();var a=function(e,r){return"function"==typeof r?u.withFilter(r).getTable(e):u.getTable(e)},f=function(e){return"undefined"==typeof e||"object"!=typeof e&&"function"!=typeof e},d=function(e){return g(e)||"object"!=typeof e},g=function(e){return null===e||"undefined"==typeof e},p=function(e){return!g(e)},m=function(r){var n=e.defer();return r.done(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise};return{query:function(e,r,n){var o=null;if(g(e))return console.error("Azureservice.query: You must specify a table name"),null;if(angular.isDefined(r)&&angular.isObject(r)){if(f(r.criteria)&&(r.criteria={}),o=a(e,n).where(r.criteria,r.params),p(r.take)&&angular.isNumber(r.take)&&(o=o.take(r.take)),p(r.skip)&&angular.isNumber(r.take)&&(o=o.skip(r.skip)),angular.isDefined(r.orderBy)&&angular.isArray(r.orderBy))for(var t=r.orderBy,i=0;i<t.length;i++){var u=t[i].column,s=t[i].direction;angular.isDefined(u)&&(angular.isDefined(s)&&"desc"===s.toLowerCase()?o=o.orderByDescending(u):angular.isDefined(u)&&(o=o.orderBy(u)))}angular.isDefined(r.columns)&&angular.isArray(r.columns)&&(o=o.select(r.columns.join()))}else o=a(e,n).where({});return m(o.includeTotalCount().read())},getById:function(e,r,n){return g(e)?(console.error("Azureservice.getById: You must specify a table name"),null):g(r)?(console.error("Azureservice.getById: You must specify the id"),null):m(a(e,n).lookup(r))},getAll:function(e,r){return this.query(e,null,r)},read:function(e,r,n){return m(a(e,n).read(r))},insert:function(e,r,n){return g(e)?(console.error("Azureservice.insert: You must specify a table name"),null):d(r)?(console.error("Azureservice.insert: You must specify the insert object"),null):m(a(e,n).insert(r))},update:function(e,r,n){return g(e)?(console.error("Azureservice.update: You must specify a table name"),null):d(r)?(console.error("Azureservice.update: You must specify the insert object"),null):m(a(e,n).update(r))},del:function(e,r,n){return g(e)?(console.error("Azureservice.del: You must specify a table name"),null):d(r)?(console.error("Azureservice.del: You must specify the insert object"),null):m(a(e,n).del(r))},login:function(e){if(!angular.isDefined(e)||-1===t.indexOf(e))throw new Error("Azureservice.login Invalid or no oauth provider listed.");var r=u.login(e).then(function(){s(u.currentUser)});return m(r)},setCurrentUser:function(e){angular.isDefined(e)&&angular.isObject(e)&&(l(e),s(e))},logout:function(){sessionStorage.loggedInUser=null,u.logout()},isLoggedIn:function(){return p(u.currentUser)&&p(sessionStorage.loggedInUser)},invokeApi:function(r,n){var o=e.defer(),t=["get","post","put","delete"];if(g(r))return console.error("Azureservice.invokeApi No custom api name specified"),null;if(d(n))n={method:"get"};else if(g(n.method))n.method="get";else if(-1===t.indexOf(n.method.toLowerCase()))return console.error("Azureservice.invokeApi Invalid method type"),null;return u.invokeApi(r,n).done(function(e){o.resolve(e.result)},function(e){o.reject(e)}),o.promise}}}]);