angular.module("azure-mobile-service.module",[]).service("Azureservice",["$window","$q","AzureMobileServiceClient",function(e,r,n){"use strict";var t,o,i,u=["google","twitter","facebook","microsoftaccount","aad"],s=function(){if(m(n.API_URL))throw"Angularservice: Unable to configure the MS Mobile Client.  Missing API URL";var e=n.API_KEY||null;t=WindowsAzure.MobileServiceClient,o=new t(n.API_URL,e)},l=function(){i="string"==typeof n.STORAGE&&"local"===n.STORAGE.toLowerCase()?e.localStorage:e.sessionStorage},c=function(e){i.loggedInUser=JSON.stringify(e)},a=function(e){o.currentUser=e},f=function(){i.loggedInUser&&(o.currentUser=JSON.parse(i.loggedInUser))},d=function(e,r){return"function"==typeof r?o.withFilter(r).getTable(e):o.getTable(e)},g=function(e){return"undefined"==typeof e||"object"!=typeof e&&"function"!=typeof e},p=function(e){return m(e)||"object"!=typeof e},m=function(e){return null===e||"undefined"==typeof e},v=function(e){return!m(e)},y=function(e){var n=r.defer();return e.done(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},A=function(){s(),l(),f()};return A(),{query:function(e,r,n){var t=null;if(m(e))return console.error("Azureservice.query: You must specify a table name"),null;if(angular.isDefined(r)&&angular.isObject(r)){if(g(r.criteria)&&(r.criteria={}),t=d(e,n),v(r.systemProperties)&&angular.isNumber(r.systemProperties)&&(t.systemProperties=r.systemProperties),t=t.where(r.criteria,r.params),v(r.take)&&angular.isNumber(r.take)&&(t=t.take(r.take)),v(r.skip)&&angular.isNumber(r.take)&&(t=t.skip(r.skip)),angular.isDefined(r.orderBy)&&angular.isArray(r.orderBy))for(var o=r.orderBy,i=0;i<o.length;i++){var u=o[i].column,s=o[i].direction;angular.isDefined(u)&&(angular.isDefined(s)&&"desc"===s.toLowerCase()?t=t.orderByDescending(u):angular.isDefined(u)&&(t=t.orderBy(u)))}angular.isDefined(r.columns)&&angular.isArray(r.columns)&&(t=t.select(r.columns.join()))}else t=d(e,n).where({});return y(t.includeTotalCount().read())},getById:function(e,r,n){return m(e)?(console.error("Azureservice.getById: You must specify a table name"),null):m(r)?(console.error("Azureservice.getById: You must specify the id"),null):y(d(e,n).lookup(r))},getAll:function(e,r){return this.query(e,null,r)},read:function(e,r,n){return y(d(e,n).read(r))},insert:function(e,r,n){return m(e)?(console.error("Azureservice.insert: You must specify a table name"),null):p(r)?(console.error("Azureservice.insert: You must specify the insert object"),null):y(d(e,n).insert(r))},update:function(e,r,n){return m(e)?(console.error("Azureservice.update: You must specify a table name"),null):p(r)?(console.error("Azureservice.update: You must specify the insert object"),null):y(d(e,n).update(r))},del:function(e,r,n){return m(e)?(console.error("Azureservice.del: You must specify a table name"),null):p(r)?(console.error("Azureservice.del: You must specify the insert object"),null):y(d(e,n).del(r))},login:function(e,r){if(!angular.isDefined(e)||-1===u.indexOf(e))throw new Error("Azureservice.login Invalid or no oauth provider listed.");var n=o.login(e,r).then(function(){c(o.currentUser)});return y(n)},setCurrentUser:function(e){angular.isDefined(e)&&angular.isObject(e)&&(a(e),c(e))},getCurrentUser:function(){return o.currentUser},logout:function(){i.loggedInUser=null,o.logout()},isLoggedIn:function(){return v(o.currentUser)&&v(i.loggedInUser)},invokeApi:function(e,n){var t=r.defer(),i=["get","post","put","delete","patch"];if(m(e))return console.error("Azureservice.invokeApi No custom api name specified"),null;if(p(n))n={method:"get"};else if(m(n.method))n.method="get";else if(-1===i.indexOf(n.method.toLowerCase()))return console.error("Azureservice.invokeApi Invalid method type"),null;return o.invokeApi(e,n).done(function(e){t.resolve(e.result)},function(e){t.reject(e)}),t.promise}}}]);